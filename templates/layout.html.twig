{% extends 'base.html.twig' %}

{% block meta %}
{% endblock %}

{% block stylesheets %}
  <!-- Begin loading animation -->
  <!--Floating WhatsApp css-->
  <link rel="stylesheet" href="https://rawcdn.githack.com/rafaelbotazini/floating-whatsapp/3d18b26d5c7d430a1ab0b664f8ca6b69014aed68/floating-wpp.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" integrity="sha256-PHcOkPmOshsMBC+vtJdVr5Mwb7r0LkSVJPlPrp/IMpU=" crossorigin="anonymous" />
  <link href="{{ asset('assets/css/loaders/loader-pulse.css')}}" rel="stylesheet" type="text/css" media="all" />
  <!-- End loading animation -->
  <link href="{{ asset('assets/css/theme.css')}}" rel="stylesheet" type="text/css" media="all" />
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,400i,600,700&display=swap" rel="stylesheet">
  <style type="text/css">
      .navbar img.logo{width: 140px}
      .navbar img.logo.scrolled-logo {display: none;}
      .navbar.scrolled img.logo.default-logo {display: none;}
      .navbar.scrolled img.logo.scrolled-logo {display: block;}
      .floating-wpp{
        bottom: 20px;
        z-index: 9999;
      }
      .floating-wpp .floating-wpp-button{
        width: 55px!important;
        height: 55px!important;
      }
      .floating-wpp .floating-wpp-popup.active{
        bottom: 60px;
      }
      .floating-wpp:hover{bottom: 21px;}
      html {
        scroll-behavior: smooth;
      }
      ul{list-style: none;}
      .cart-wrapper {
        position: fixed;
        top: 0;
        height: 100vh;
        width: 290px;
        background: #fff;
        z-index: 1030;
        padding: 45px 20px 10px;
        transition: linear .2s right;
        right: -290px;
        overflow-y: auto;
        box-shadow: 0px 5px 25px -5px rgba(0, 0, 0, 0.1);
        font-size: 14px;
    }
    .cart-wrapper.open{right: 0}
    .cart-wrapper .product-item img.product-img {
      height: 60px;
      width: 80px;
      object-fit: cover;
      border-radius: 5px;
      box-shadow: 0px 5px 15px -5px rgba(0, 0, 0, 0.1);
      float: left;
      margin-right: 13px;
    }
    .cart-wrapper .product-item ul.detail-list {
      padding-left: 14px;
    }
    .cart-wrapper .form-coupon{
      display: flex;
      align-items: stretch;
    }
    .cart-wrapper .form-coupon .valide-coupon {
      background: #009b72;
      color: #fff;
      width: 105px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .cart-wrapper .totaux{
      padding: 0;
      line-height: 27px;
      margin-top: 25px;
    }
    .cart-wrapper .totaux > .item > span:last-child {
      font-weight: 800;
      float: right;
    }
    .cart-wrapper .form-control, .cart-wrapper .form-control:focus{
      border-radius: 0!important;
    }
    .cart-wrapper .toggle-cart{
      cursor: pointer;
      position: absolute;
      top: 12px;
      color: #888;
    }

/**
     * The CSS shown here will not be introduced in the Quickstart guide, but shows
     * how you can use CSS to style your Element's container.
     */
    .StripeElement {
      box-sizing: border-box;

      height: 40px;

      padding: 10px 12px;

      border: 1px solid transparent;
      border-radius: 4px;
      background-color: white;

      -webkit-transition: box-shadow 150ms ease;
      transition: box-shadow 150ms ease;
      border:1px solid #f4f4f4;
    }

    .StripeElement--focus {
      box-shadow: 0 1px 3px 0 #cfd7df;
    }

    .StripeElement--invalid {
      border-color: #fa755a;
    }

    .StripeElement--webkit-autofill {
      background-color: #fefde5 !important;
    }
    #card-errors{color: #c31b1b}
    #stripePaidBox button.submit {
        cursor: pointer;
        display: inline-block;
        height: 40px;
        width: 100%;
        margin-top: 40px;
        font-size: 15px;
        font-weight: 600;
        line-height: 40px;
        letter-spacing: 0.025em;
        text-decoration: none;
        white-space: nowrap;
        background: #b64645;
        color: #fff;
        border: none;
        outline: none;
        border-radius: 4px;
        box-shadow: 0 4px 6px rgba(50, 50, 93, .11), 0 1px 3px rgba(0, 0, 0, .08);
        -webkit-transition: all 150ms ease;
        transition: all 150ms ease;
    }
    #stripePaidBox .paid-head{
        text-align: center;
        color: #b64645;
        margin-top: 15px;
    }
    .lds-ripple {
        display: none;
        width: 80px;
        height: 80px;
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        margin: auto;
        transform: translateY(-50%);
        z-index: 50;
    }
    .lds-ripple div {
      position: absolute;
      border: 4px solid green;
      opacity: 1;
      border-radius: 50%;
      animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
    }
    .lds-ripple div:nth-child(2) {
      animation-delay: -0.5s;
    }
    @keyframes lds-ripple {
      0% {
        top: 36px;
        left: 36px;
        width: 0;
        height: 0;
        opacity: 1;
      }
      100% {
        top: 0px;
        left: 0px;
        width: 72px;
        height: 72px;
        opacity: 0;
      }
    }
    .form-group{margin-bottom: 5px;}
    #modal-payment .modal-dialog{max-width: 400px;}
    .list-cart{
      position: absolute;
    }
    .list-inline-item:not(:last-child){margin-right: 0}
    .list-inline-item .fa-2x {
      color: #009b72!important;
      font-size: 1.7em;
    }

    /**
     * Extracted from: SweetAlert
     * Modified by: Istiak Tridip
     */
    .success-checkmark {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        transform: translateY(-50%);
        z-index: 60;
      width: 80px;
      height: 115px;
      margin: 0 auto;
      display: none;
    }
    .success-checkmark .check-icon {
      width: 80px;
      height: 80px;
      position: relative;
      border-radius: 50%;
      box-sizing: content-box;
      border: 4px solid #4CAF50;
      display: none;
    }
    .success-checkmark .check-icon::before {
      top: 3px;
      left: -2px;
      width: 30px;
      transform-origin: 100% 50%;
      border-radius: 100px 0 0 100px;
    }
    .success-checkmark .check-icon::after {
      top: 0;
      left: 30px;
      width: 60px;
      transform-origin: 0 50%;
      border-radius: 0 100px 100px 0;
      animation: rotate-circle 4.25s ease-in;
    }
    .success-checkmark .check-icon::before, .success-checkmark .check-icon::after {
      content: '';
      height: 100px;
      position: absolute;
      background: #FFFFFF;
      transform: rotate(-45deg);
    }
    .success-checkmark .check-icon .icon-line {
      height: 5px;
      background-color: #4CAF50;
      display: block;
      border-radius: 2px;
      position: absolute;
      z-index: 10;
    }
    .success-checkmark .check-icon .icon-line.line-tip {
      top: 46px;
      left: 14px;
      width: 25px;
      transform: rotate(45deg);
      animation: icon-line-tip 0.75s;
    }
    .success-checkmark .check-icon .icon-line.line-long {
      top: 38px;
      right: 8px;
      width: 47px;
      transform: rotate(-45deg);
      animation: icon-line-long 0.75s;
    }
    .success-checkmark .check-icon .icon-circle {
      top: -4px;
      left: -4px;
      z-index: 10;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      position: absolute;
      box-sizing: content-box;
      border: 4px solid rgba(76, 175, 80, 0.5);
    }
    .success-checkmark .check-icon .icon-fix {
      top: 8px;
      width: 5px;
      left: 26px;
      z-index: 1;
      height: 85px;
      position: absolute;
      transform: rotate(-45deg);
      background-color: #FFFFFF;
    }

    @keyframes rotate-circle {
      0% {
        transform: rotate(-45deg);
      }
      5% {
        transform: rotate(-45deg);
      }
      12% {
        transform: rotate(-405deg);
      }
      100% {
        transform: rotate(-405deg);
      }
    }
    @keyframes icon-line-tip {
      0% {
        width: 0;
        left: 1px;
        top: 19px;
      }
      54% {
        width: 0;
        left: 1px;
        top: 19px;
      }
      70% {
        width: 50px;
        left: -8px;
        top: 37px;
      }
      84% {
        width: 17px;
        left: 21px;
        top: 48px;
      }
      100% {
        width: 25px;
        left: 14px;
        top: 45px;
      }
    }
    @keyframes icon-line-long {
      0% {
        width: 0;
        right: 46px;
        top: 54px;
      }
      65% {
        width: 0;
        right: 46px;
        top: 54px;
      }
      84% {
        width: 55px;
        right: 0px;
        top: 35px;
      }
      100% {
        width: 47px;
        right: 8px;
        top: 38px;
      }
    }
    .box-error-payment{
      display: none;
      position: absolute;
      top: 0;
      width: 100%;
      left: 0;
      z-index: 2;
    }
  </style>
{% endblock %}

{% block body %}
   <div class="loader">
      <div class="loading-animation"></div>
   </div>
   
   <div class="alert alert-dismissible d-none d-md-block bg-primary-3 text-white py-4 py-md-3 px-0 mb-0 rounded-0 border-0" style="bottom: 0px;position: fixed;width: 100%;z-index: 2;">
      <div class="container">
         <div class="row no-gutters align-items-md-center justify-content-center">
            <div class="col-lg-11 col-md d-flex flex-column flex-md-row align-items-md-center justify-content-lg-center">
               <div class="mb-3 mb-md-0">üò∑ Malgr√© le Coronavirus nous assurons toute les livraisons sans risques de contamination.</div>
            </div>
            <div class="col-auto position-absolute right">
               <button type="button" class="close p-0 position-relative" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" class="injected-svg icon icon-sm bg-white" data-src="{{ asset('assets/img/icons/interface/icon-x.svg')}}" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <path d="M18 6L6 18" stroke="#2C3038" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        <path d="M6 6L18 18" stroke="#2C3038" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                     </svg>
                  </span>
               </button>
            </div>
         </div>
      </div>
   </div>
  
   <div class="navbar-container">
      <nav class="navbar navbar-expand-lg navbar-dark" data-overlay data-sticky="top">
         <div class="container">
            <a class="navbar-brand navbar-brand-dynamic-color fade-page" href="">
               <img src="assets/img/logos/logo-noir.png" class="logo scrolled-logo" alt="logo">
               <img src="assets/img/logos/logo-blanc.png" class="logo default-logo" alt="logo">
             </a>
            <div class="d-flex align-items-center order-lg-3">
              <!--  <a href="https://wa.me/237656645659" target="_blank" class="btn btn-primary ml-lg-4 mr-3 mr-md-4 mr-lg-0 d-none d-sm-block order-lg-3" style=" background-color: #009b72; border-color: #009b72; color: #ffffff; "><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/1200px-WhatsApp.svg.png" style="height: 22px;margin-bottom: 2px;"> 06 85 74 96 12</a> -->
               
                  <a href="javascript:void()"  data-id="je_minscris-form" class="je-minscris btn btn-primary ml-lg-4 mr-3 mr-md-4 mr-lg-0 d-none d-sm-block order-lg-3 toggle-cart"><i class="fa fa-shopping-cart" style="color:#fff"></i></a>
               {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                  <!-- <p>Email: {{ app.user.email }}</p> -->

                  <a href="{{ path('app_logout') }}" data-id="je_minscris-form" class="je-minscris btn btn-secondary ml-lg-4 mr-3 mr-md-4 mr-lg-0 d-none d-sm-block order-lg-3">Deconnexion</a>
              {% else %}   
                  <a href="{{ path('app_login') }}" data-id="je_minscris-form" class="je-minscris btn btn-primary ml-lg-4 mr-3 mr-md-4 mr-lg-0 d-none d-sm-block order-lg-3">Connexion</a>

              {% endif %}
               <button aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target=".navbar-collapse" data-toggle="collapse" type="button">
                 <img alt="Navbar Toggler Open Icon" class="navbar-toggler-open icon icon-sm" data-inject-svg src="{{ asset('assets/img/icons/interface/icon-menu.svg')}}">
                 <img alt="Navbar Toggler Close Icon" class="navbar-toggler-close icon icon-sm" data-inject-svg src="{{ asset('assets/img/icons/interface/icon-x.svg')}}">
               </button>
            </div>
            <div class="collapse navbar-collapse order-3 order-lg-2 justify-content-lg-end" id="navigation-menu">
            <ul class="navbar-nav my-3 my-lg-0">
              <li class="nav-item">
                <div >
                  <a aria-haspopup="true" class="nav-link nav-item" data-toggle="dropdown-grid" href="{{ url('home') }}#boutique" role="button">Boutique</a>
                </div>
              </li>
              <li class="nav-item">
                <div>
                  <a aria-expanded="false" aria-haspopup="true" class="nav-link nav-item" data-toggle="dropdown-grid" href="#" role="button">Livraison</a>
                </div>
              </li>
              <li class="nav-item">
                <div>
                  <a aria-expanded="false" aria-haspopup="true" class="nav-link nav-item" data-toggle="dropdown-grid" href="#" role="button">Contact</a>
                </div>
              </li>
            </ul>
          </div>
         </div>
      </nav>
   </div>

   <main id="main" class="site-main" role="main">
      {% block body_web %}{% endblock body_web %}
   </main>
   <div class="cart-wrapper">
      <i class="fa fa-arrow-right toggle-cart"></i>
      <div class="cart-container">
        <div class="product-list">
          <div class="card-list-product">
          </div>
          <div class="card-list-formule">
          </div>
          <div class="form-group form-coupon">
              <input type="text" name="code-promo" id="code-promo-input" class="form-control" placeholder="Code promo..." style="border-radius:0">
              <a href="javascript:void()" onclick ="addCouponToCard('#code-promo-input',1)" class="valide-coupon">je valide!</a>
            </div>
            <ul class="totaux card-list-coupon">
            </ul>
            <ul class="totaux card-list-details">
            </ul>
            <div>
              <a href="javascript:void()" class="btn btn-primary ml-lg-4 mr-3 mr-md-4 mr-lg-0 d-none d-sm-block order-lg-3 open-modal-payment">Paiement de <b class="cart-total-pay">o</b>‚Ç¨ <strike><i class="cart-total-reduction">0</i>‚Ç¨ </strike></a>
            </div>
            {% if is_granted('IS_AUTHENTICATED_FULLY') and (app.user.getStripeCustomId is not null) %}
              <div style="text-align: center;margin-top: 19px;font-size: 16px">
                  <a href="{{path('direct_paid')}}" class="oneClickPaid" style="text-decoration: underline;" title="Vous serez automatiquement debit√© sur la precedente carte utilis√©e">Payer en 1 click</a><br>
                  <small style="display: block;margin-top: 6px;">Pour le paiement en un click, Vous serez automatiquement debit√© sur votre precedente carte utilis√©e</small>
              </div>
            {% endif %}
            
        </div>
      </div>
   </div>
   <div class="modal fade" id="modal-payment" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="alert alert-danger alert-dismissible fade show box-error-payment" role="alert">
            <span class="text"></span>
            <button type="button" class="close close-alert-msg">
              x
            </button>
          </div>
          <div class="modal-header text-center border-0">
            <ul class="list-inline list-cart">
                <li class="list-inline-item"><i class="text-muted fa fa-cc-visa fa-2x"></i></li>
                <li class="list-inline-item"><i class="fa fa-cc-mastercard fa-2x"></i></li>
                <li class="list-inline-item"><i class="fa fa-cc-amex fa-2x"></i></li>
                <li class="list-inline-item"><i class="fa fa-cc-discover fa-2x"></i></li>
            </ul>
            <div class="w-100 pt-4">
              <h5 class="h4" style="margin: 1.5rem; color: green">Paiement securis√© <i class="fa fa-key"></i></h5>
            </div>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">
                <img src="assets/img/icons/interface/icon-x.svg" alt="Icon">
              </span>
            </button>
          </div>
          <div class="modal-body px-md-4 px-lg-5 pb-4 pb-lg-5" style="padding-top: 0;">
            <form id="payment-form" name="payment-form" action="{{path('checkout_product')}}" style="position: relative;">
              <div class="form-group">
                <input type="text" class="form-control" name="name" placeholder="nom" value="{{ app.user ? app.user.name : '' }}">
              </div>
              <div class="form-group">
                <input type="email" class="form-control" name="email" placeholder="adresse email" value="{{ app.user ? app.user.email : '' }}">
              </div>
              <div class="form-group">
                  <div id="card-element">
                    <!-- A Stripe Element will be inserted here. -->
                  </div>

                  <!-- Used to display form errors. -->
                  <div id="card-errors" role="alert"></div>
                </div>
              <button class="btn btn-primary btn-block" type="submit" style="margin-top: 20px;">Valider</button>
              <div class="lds-ripple"><div></div><div></div></div>
              <div class="success-checkmark">
                <div class="check-icon">
                  <span class="icon-line line-tip"></span>
                  <span class="icon-line line-long"></span>
                  <div class="icon-circle"></div>
                  <div class="icon-fix"></div>
                </div>
              </div>
            </form>
            <div class="text-center text-small mt-3">
              Vous avez d√©j√† un compte? <a href="{{path('app_login')}}">Connectez-vous</a>
            </div>
          </div>
        </div>
      </div>
    </div>
   <footer class="bg-primary-3 text-white links-white pb-4 footer-1">
      <div class="container">
         <div class="row">
            <div class="col-xl-auto mr-xl-5 col-md-3 mb-4 mb-md-0">
               <h5>Demos</h5>
               <ul class="nav flex-row flex-md-column">
                  <li class="nav-item mr-3 mr-md-0">
                     <a href="landing-1.html" class="nav-link fade-page px-0 py-2">Landing 1</a>
                  </li>
               </ul>
            </div>
            <div class="col-xl-auto mr-xl-5 col-md-3">
               <h5>Pages</h5>
               <ul class="nav flex-row flex-md-column">
                  <li class="nav-item mr-3 mr-md-0">
                     <a href="company-about-1.html" class="nav-link fade-page px-0 py-2">Company</a>
                  </li>
               </ul>
            </div>
         </div>
         <div class="row">
            <div class="col">
               <hr>
            </div>
         </div>
         <div class="row flex-column flex-lg-row align-items-center justify-content-center justify-content-lg-between text-center text-lg-left">
            <div class="col-auto">
               <div class="d-flex flex-column flex-sm-row align-items-center text-small">
                  <div class="text-muted">&copy; 2020, ePodsOne  <a href="https://www.google.com/policies/privacy/" target="_blank">Protection des donnees</a> et <a href="https://policies.google.com/terms" target="_blank">Conditions d'utilisation</a>
                  </div>
               </div>
            </div>
            <div class="col-auto mt-3 mt-lg-0">
               <ul class="list-unstyled d-flex mb-0">
                  <li class="mx-3">
                     <a href="#" class="hover-fade-out">
                     <img src="{{ asset('assets/img/icons/social/twitter.svg')}}" alt="Twitter" class="icon icon-xs bg-white" data-inject-svg>
                     </a>
                  </li>
                  <li class="mx-3">
                     <a href="#" class="hover-fade-out">
                     <img src="{{ asset('assets/img/icons/social/facebook.svg')}}" alt="Facebook" class="icon icon-xs bg-white" data-inject-svg>
                     </a>
                  </li>
               </ul>
            </div>
         </div>
      </div>
   </footer>
   <a href="#top" class="btn btn-primary rounded-circle btn-back-to-top" data-smooth-scroll data-aos="fade-up" data-aos-offset="2000" data-aos-mirror="true" data-aos-once="false">
   <img src="{{ asset('assets/img/icons/interface/icon-arrow-up.svg')}}" alt="Icon" class="icon bg-white" data-inject-svg>
   </a>
{% endblock %}

{% block javascripts %}
  <!-- Required vendor scripts (Do not remove) -->
  <script type="text/javascript" src="{{ asset('assets/js/jquery.min.js')}}"></script>
  <script type="text/javascript" src="{{ asset('assets/js/popper.min.js')}}"></script>
  <script type="text/javascript" src="{{ asset('assets/js/bootstrap.js')}}"></script>

  <!-- Optional Vendor Scripts (Remove the plugin script here and comment initializer script out of index.js if site does not use that feature) -->

  <!-- AOS (Animate On Scroll - animates elements into view while scrolling down) -->
  <script type="text/javascript" src="{{ asset('assets/js/aos.js')}}"></script>
  <!-- Clipboard (copies content from browser into OS clipboard) -->
  <script type="text/javascript" src="{{ asset('assets/js/clipboard.min.js')}}"></script>
  <!-- Fancybox (handles image and video lightbox and galleries) -->
  <script type="text/javascript" src="{{ asset('assets/js/jquery.fancybox.min.js')}}"></script>
  <!-- Flatpickr (calendar/date/time picker UI) -->
  <script type="text/javascript" src="{{ asset('assets/js/flatpickr.min.js')}}"></script>
  <!-- Flickity (handles touch enabled carousels and sliders) -->
  <script type="text/javascript" src="{{ asset('assets/js/flickity.pkgd.min.js')}}"></script>
  <!-- Ion rangeSlider (flexible and pretty range slider elements) -->
  <script type="text/javascript" src="{{ asset('assets/js/ion.rangeSlider.min.js')}}"></script>
  <!-- Isotope (masonry layouts and filtering) -->
  <script type="text/javascript" src="{{ asset('assets/js/isotope.pkgd.min.js')}}"></script>
  <!-- jarallax (parallax effect and video backgrounds) -->
  <script type="text/javascript" src="{{ asset('assets/js/jarallax.min.js')}}"></script>
  <script type="text/javascript" src="{{ asset('assets/js/jarallax-video.min.js')}}"></script>
  <script type="text/javascript" src="{{ asset('assets/js/jarallax-element.min.js')}}"></script>
  <!-- jQuery Countdown (displays countdown text to a specified date) -->
  <script type="text/javascript" src="{{ asset('assets/js/jquery.countdown.min.js')}}"></script>
  <!-- jQuery smartWizard facilitates steppable wizard content -->
  <script type="text/javascript" src="{{ asset('assets/js/jquery.smartWizard.min.js')}}"></script>
  <!-- Plyr (unified player for Video, Audio, Vimeo and Youtube) -->
  <script type="text/javascript" src="{{ asset('assets/js/plyr.polyfilled.min.js')}}"></script>
  <!-- Prism (displays formatted code boxes) -->
  <script type="text/javascript" src="{{ asset('assets/js/prism.js')}}"></script>
  <!-- ScrollMonitor (manages events for elements scrolling in and out of view) -->
  <script type="text/javascript" src="{{ asset('assets/js/scrollMonitor.js')}}"></script>
  <!-- Smooth scroll (animation to links in-page)-->
  <script type="text/javascript" src="{{ asset('assets/js/smooth-scroll.polyfills.min.js')}}"></script>
  <!-- SVGInjector (replaces img tags with SVG code to allow easy inclusion of SVGs with the benefit of inheriting colors and styles)-->
  <script type="text/javascript" src="{{ asset('assets/js/svg-injector.umd.production.js')}}"></script>
  <!-- TwitterFetcher (displays a feed of tweets from a specified account)-->
  <script type="text/javascript" src="{{ asset('assets/js/twitterFetcher_min.js')}}"></script>
  <!-- Typed text (animated typing effect)-->
  <script type="text/javascript" src="{{ asset('assets/js/typed.min.js')}}"></script>
  <!-- Required theme scripts (Do not remove) -->
  <script type="text/javascript" src="{{ asset('assets/js/theme.js')}}"></script>
  
    <link href="{{ asset('assets/Notification/css/ussal-notification.css')}}" rel="stylesheet" type="text/css" media="all" />

  <script type="text/javascript" src="{{ asset('assets/Notification/js/ussal-notification.js')}}"></script>
  <!-- Removes page load animation when window is finished loading -->
  <script src="https://js.stripe.com/v3/"></script>
  <script type="text/javascript">
    window.addEventListener("load",function(){
      document.querySelector('body').classList.add('loaded');
    });
    $('.toggle-cart').click(function(){
      $('.cart-wrapper').toggleClass('open');

    })
    $(".open-modal-payment").click(function(){
      $("#modal-payment").modal({backdrop: "static"});
    });
    $('.close-alert-msg').click(function(){
      $('#modal-payment .alert-dismissible').css('display','none');
    });
  </script>
  <script type="text/javascript">
        var stripe = Stripe('pk_test_CtAIy4NNabE9gv280qV4UijC');

        var elements = stripe.elements();
        var style = {
          base: {
            color: '#32325d',
            fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
            fontSmoothing: 'antialiased',
            fontSize: '16px',
            '::placeholder': {
              color: '#aab7c4'
            }
          },
          invalid: {
            color: '#fa755a',
            iconColor: '#fa755a'
          }
        };

        // Create an instance of the card Element.
        var card = elements.create('card', {
            style: style,
            hidePostalCode : true
        });

        // Add an instance of the card Element into the `card-element` <div>.
        card.mount('#card-element');

        // Handle real-time validation errors from the card Element.
        card.addEventListener('change', function(event) {
          var displayError = document.getElementById('card-errors');
          if (event.error) {
            displayError.textContent = event.error.message;
          } else {
            displayError.textContent = '';
          }
        });

        // Handle form submission.
        var form = document.getElementById('payment-form');
        form.addEventListener('submit', function(event) {
          $('#stripePaidBox button.submit').css('pointer-events','none');
            event.preventDefault();
            function validate(){
                try{
                    var validator = $('#payment-form').validate({
                        rules:{
                            name:{
                                required:true
                            },
                            email:{
                                required:true,
                                email:true
                            },
                        }
                    });
                    
                    var $validated = $('#payment-form').valid();
                    return $validated;
                }catch(error){
                    console.log(error)
                }
            }
            var ownerInfo = {
                owner: {},
            };
            stripe.createSource(card, ownerInfo).then(function(result) {
                if (!validate() || result.error) {
                  var errorElement = document.getElementById('card-errors');
                  errorElement.textContent = result.error.message;
                  $('#stripePaidBox button.submit').css('pointer-events','auto');
                } else {
                  stripeSourceHandler(result.source);
                }
            });
        });

        function stripeSourceHandler(source) {
          $('#stripePaidBox button.submit').css('pointer-events','none');
            $('.lds-ripple').css('display','inline-block');
            // Insert the source ID into the form so it gets submitted to the server
            var form = document.getElementById('payment-form');
            var hiddenInput = document.createElement('input');
            hiddenInput.setAttribute('type', 'hidden');
            hiddenInput.setAttribute('name', 'stripeSource');
            hiddenInput.setAttribute('value', source.id);
            form.appendChild(hiddenInput);

            // Submit the form
            //form.submit();
            proceedPayment();
        }
        function proceedPayment(){
            var form = document.getElementById('payment-form');
            oData = new FormData(form);
            var oReq = new XMLHttpRequest();
            oReq.open("POST", $('#payment-form').attr('action'), true);
            oReq.onload = function(oEvent) {
                if (oReq.status == 200) {
                    $(".success-checkmark").show().delay(3000).fadeOut();
                    $(".check-icon").show().show().delay(3000).fadeOut();
                    $('#modal-payment').modal('hide');
                    notification("Paiement commande",oReq.response,"success");
                    card.clear();
                    $('#stripePaidBox button.submit').css('pointer-events','auto');
                    $('.lds-ripple').css('display','none');

                    $("#modal-payment .alert-dismissible").show().delay(40000).fadeOut();
                    $('#modal-payment .alert-dismissible').removeClass('alert-danger');
                    $('#modal-payment .alert-dismissible').addClass('alert-success');
                    $('#modal-payment .alert-dismissible .text').text(oReq.response);
                    window.location.href = $('body').data('base-url');

                } else {
                    notification("Paiement commande",oReq.response,"error");
                    $('#stripePaidBox button.submit').css('pointer-events','auto');
                    $('.lds-ripple').css('display','none');

                    $("#modal-payment .alert-dismissible").show().delay(40000).fadeOut();
                    $('#modal-payment .alert-dismissible').removeClass('alert-success');
                    $('#modal-payment .alert-dismissible').addClass('alert-danger');
                    $('#modal-payment .alert-dismissible .text').text(oReq.response);
                }
            };
            oReq.send(oData);  
        }

        $('.oneClickPaid').click(function(e){
          $(this).text('paiement en cours...');
          $(this).css('pointer-events', 'none');
          var $url = $(this).attr("href");
          proceed($url, $(this));
          e.preventDefault();
        });
        function proceed($url, $that){
          $.ajax({
              url: $url,
              type: "GET",
              dataType: "json",
              async: true,
              data: {},
              success: function(data, status) {
                $that.css('pointer-events', 'auto');
                $that.text("Payer en 1 click");
                notification("Paiement commande","Paiement effectu√© avec succ√®ss","success");
              },
              error: function(xhr, textStatus, errorThrown) {
                $that.css('pointer-events', 'auto');
                $that.text("Payer en 1 click");
                notification("Paiement commande",errorThrown,"error");
              }
          });
        }
</script>
{% endblock %}
